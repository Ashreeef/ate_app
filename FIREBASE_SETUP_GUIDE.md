# üöÄ Firebase Setup - Team Instructions

**Created by:** Ashref 
**Date:** December 23, 2025  
**Status:** ‚úÖ Base setup complete - Ready for team

---

## ‚úÖ What's Already Done

I've completed the following setup tasks:

### 1. Dependencies Installed
- ‚úÖ Firebase Core, Auth, Firestore
- ‚úÖ Firebase Crashlytics, Analytics, Messaging
- ‚úÖ **Cloudinary** for image storage (25GB free - better than Firebase Storage)
- ‚úÖ Cached Network Image for Firebase URLs
- ‚úÖ All packages compatible and installed

### 2. Base Services Created
Created 3 core services in `lib/services/`:

- **`firebase_auth_service.dart`** - Handles all Firebase Authentication
  - Sign up, sign in, sign out
  - Password reset, email update
  - Error handling with user-friendly messages

- **`cloudinary_storage_service.dart`** - Handles image uploads (100% FREE)
  - Profile image upload with compression
  - Post images upload (multiple)
  - Automatic optimization
  - 25GB storage + 25GB bandwidth/month (vs Firebase 5GB)
  - No credit card required

- **`firestore_service.dart`** - Base Firestore service
  - Collection references
  - Batch operations
  - Transaction support
  - Offline persistence

### 3. Firebase Options
- ‚úÖ Created `lib/firebase_options.dart` with project config
- ‚úÖ Using existing project: `ate-app-112`

### 4. Main.dart Updated
- ‚úÖ Firebase initialization added
- ‚úÖ Crashlytics error handling enabled
- ‚úÖ Imports organized

---

## üîß Next Steps - BEFORE You Start Working

### Step 1: Pull Latest Changes
```bash
git pull origin develop
```

### Step 2: Install Dependencies
```bash
flutter pub get
```

### Step 3: Test Firebase Connection
Run the app and check console for:
```
Firebase initialized successfully
```

If you see errors, message me immediately!

---

## üìã Firebase Console Access

**Project:** ate-app-112  
**Console:** https://console.firebase.google.com/project/ate-app-112

### Services Already Enabled:
- ‚úÖ Authentication (Email/Password)
- ‚úÖ Cloud Firestore
- ‚úÖ Cloudinary (External - 100% free image storage)
- ‚úÖ Crashlytics 

### Need to Enable (I'll do this)::
- ‚è≥ Analytics

---

## üóÇÔ∏è Firestore Database Structure

Here's the schema we'll use:

### Collection: `users`
```javascript
{
  id: "<auto-generated>",
  username: "ahmed_benali",
  email: "ahmed@ate.com",
  displayName: "Ahmed Benali",
  bio: "Food lover from Algiers",
  profileImage: "https://storage.googleapis.com/...",
  phone: "+213...",
  points: 250,
  level: "Silver",
  followersCount: 45,
  followingCount: 32,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Collection: `posts`
```javascript
{
  id: "<auto-generated>",
  userId: "user123",
  username: "ahmed_benali",  // Denormalized
  userAvatar: "url",          // Denormalized
  caption: "Amazing couscous!",
  images: ["url1", "url2"],
  restaurantId: "rest123",
  restaurantName: "Caf√© El Djazair",  // Denormalized
  dishName: "Couscous Royale",
  rating: 4.5,
  likesCount: 24,
  commentsCount: 8,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Collection: `restaurants`
```javascript
{
  id: "<auto-generated>",
  name: "Caf√© El Djazair",
  location: "Didouche Mourad, Alger",
  cuisineType: "Algerian",
  rating: 4.5,
  imageUrl: "url",
  postsCount: 12,
  createdAt: Timestamp
}
```

### Subcollection: `posts/{postId}/likes`
```javascript
{
  id: "<userId>",  // Document ID = User ID
  userId: "user123",
  createdAt: Timestamp
}
```

### Subcollection: `posts/{postId}/comments`
```javascript
{
  id: "<auto-generated>",
  userId: "user123",
  username: "sarah_food",
  userAvatar: "url",
  content: "Looks delicious!",
  createdAt: Timestamp
}
```

### Collection: `follows`
```javascript
{
  id: "<followerId>_<followingId>",  // Composite key
  followerId: "user123",
  followingId: "user456",
  createdAt: Timestamp
}
```

### Collection: `savedPosts`
```javascript
{
  id: "<userId>_<postId>",  // Composite key
  userId: "user123",
  postId: "post456",
  createdAt: Timestamp
}
```

---

## üë• Your Tasks - Starting Tomorrow (Dec 24)

### **Sondes - Post Repository**
- Migrate `post_repository.dart` to use Firestore
- Update `PostBloc` to use Firebase
- Methods needed:
  - `createPost(post)` - Create post in Firestore
  - `getFeedPosts()` - Get posts ordered by date
  - `getPostsByUser(userId)` - User's posts
  - `likePost(postId, userId)` - Add to subcollection
  - `unlikePost(postId, userId)` - Remove from subcollection

### **Arslene - Restaurant Repository**
- Migrate `restaurant_repository.dart` to use Firestore
- Update `RestaurantBloc` to use Firebase
- Methods needed:
  - `createRestaurant(restaurant)`
  - `getRestaurants()` - All restaurants
  - `searchRestaurants(query)` - Search by name
  - `getRestaurantById(id)`

### **Amina - Follow/Save Repositories**
- Create `follow_repository.dart` for Firestore
- Create `saved_post_repository.dart` for Firestore
- Update `ProfileBloc` to use Firebase
- Methods needed:
  - `followUser(followerId, followingId)`
  - `unfollowUser(followerId, followingId)`
  - `savePost(userId, postId)`
  - `unsavePost(userId, postId)`

---

## üõ†Ô∏è How to Use the Services

### Example: Using FirebaseAuthService

```dart
final authService = FirebaseAuthService();

// Sign up
try {
  final userCredential = await authService.signUp(
    email: 'user@example.com',
    password: 'password123',
  );
  final uid = userCredential.user!.uid;
  // Now create user profile in Firestore
} catch (e) {
  print('Error: $e');  // User-friendly error message
}

// Sign in
try {
  await authService.signIn(
    email: email,
    password: password,
  );
} catch (e) {
  print('Login failed: $e');
}
```

### Example: Using CloudinaryStorageService

```dart
final storageService = CloudinaryStorageService();

// Upload profile image
final imageUrl = await storageService.uploadProfileImage(
  imageFile,
  userId,
);

// Upload post images
final imageUrls = await storageService.uploadPostImages(
  [image1, image2, image3],
  userId,
);

// Get optimized thumbnail for feed
final thumbnailUrl = storageService.getThumbnailUrl(imageUrl);

// Get custom sized image
final resizedUrl = storageService.getOptimizedUrl(
  imageUrl,
  width: 800,
  height: 600,
);
```

### Example: Using FirestoreService

```dart
final firestoreService = FirestoreService();

// Add document
await firestoreService.users.doc(userId).set({
  'username': 'ahmed',
  'email': 'ahmed@ate.com',
  'createdAt': firestoreService.serverTimestamp,
});

// Get document
final doc = await firestoreService.users.doc(userId).get();
final userData = doc.data() as Map<String, dynamic>;

// Query collection
final snapshot = await firestoreService.posts
  .where('userId', isEqualTo: userId)
  .orderBy('createdAt', descending: true)
  .limit(20)
  .get();
```

---

## üö® Important Rules

### 1. **ALWAYS Handle Errors**
```dart
try {
  // Firebase operation
} on FirebaseException catch (e) {
  // Handle Firebase-specific errors
} catch (e) {
  // Handle other errors
}
```

### 2. **Use Server Timestamps**
```dart
'createdAt': FieldValue.serverTimestamp()
// NOT: DateTime.now()
```

### 3. **Denormalize When Needed**
Store frequently accessed data together:
```dart
// GOOD: Store username in post
{
  'userId': 'user123',
  'username': 'ahmed',  // Denormalized
  'caption': '...'
}

// BAD: Only store userId, then query users every time
{
  'userId': 'user123',
  'caption': '...'
}
```

### 4. **Use Subcollections for One-to-Many**
```dart
// Likes as subcollection under posts
posts/{postId}/likes/{userId}

// NOT as separate collection
likes/{likeId}
```

### 5. **Batch Write for Multiple Operations**
```dart
final batch = FirebaseFirestore.instance.batch();

batch.set(docRef1, data1);
batch.update(docRef2, data2);
batch.delete(docRef3);

await batch.commit();
```

---

## üìû Communication

### Daily Standup: 8:30 PM
Be ready to share:
1. What you completed today
2. What you're working on tomorrow
3. Any blockers

### Questions?
- **Urgent:** Call me directly
- **Non-urgent:** Message in group chat
- **Code review:** Tag me in PR

---

## ‚úÖ Checklist Before You Start

- [ ] Pulled latest code from `develop` branch
- [ ] Run `flutter pub get` successfully
- [ ] App builds without errors
- [ ] You see "Firebase initialized" in console
- [ ] You understand your assigned repository
- [ ] You read this entire document

---

## üéØ Goal for This Week

By **Dec 27** (Day 5):
- ‚úÖ All repositories migrated to Firebase
- ‚úÖ All BLoCs using Firestore
- ‚úÖ Authentication working with Firebase
- ‚úÖ Posts stored in Firestore
- ‚úÖ Images uploaded to Firebase Storage

**We've got this! Let's build something amazing! üöÄ**

---

**Last Updated:** Dec 23, 2025 by Ashref  
**Next Update:** After Firebase Console setup (tomorrow)
